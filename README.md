# synaplan-memories (optional)

This repository provides the **optional Memories backend** for [Synaplan](../synaplan):

- A **Rust microservice** (`qdrant-service/`) that exposes a small HTTP API
- A **Qdrant** instance for vector storage

Synaplan can run without this repo. If you want **user profiling / AI “memories”**, install this repo and connect Synaplan to it.

## What this adds to Synaplan

- Store and retrieve **user memories** (category/key/value + created/updated timestamps)
- Semantic search over memories (vectors are generated by Synaplan backend)
- Health checks, metrics and optional webhook alerts/statistics

## Architecture (very simple)

```
Synaplan backend (PHP) -> synaplan-qdrant-service (Rust) -> Qdrant (Vector DB)
```

## Quick Start (5 minutes)

### Prerequisites

- Docker + Docker Compose
- A running Synaplan stack (recommended, because this compose joins Synaplan’s Docker network)

### 1) Start synaplan-memories

```bash
cd synaplan-memories
docker compose up -d
```

This starts:

- `synaplan-qdrant` on ports `6333` (REST) and `6334` (gRPC)
- `synaplan-qdrant-service` on port `8090`

### 2) Connect Synaplan to the service

In your Synaplan backend env (`synaplan/backend/.env`) set:

```bash
# URL of the Rust service (NOT Qdrant directly)
QDRANT_SERVICE_URL=http://synaplan-qdrant-service:8090

# Must match SERVICE_API_KEY in synaplan-memories/docker-compose.yml
QDRANT_SERVICE_API_KEY=changeme-in-production
```

Then restart Synaplan backend:

```bash
cd synaplan
docker compose restart backend
```

### 3) Verify it works

Check the microservice directly:

```bash
curl http://localhost:8090/health
```

Check Synaplan’s “memory service check” endpoint:

```bash
curl http://localhost:8000/api/v1/config/memory-service/check
```

If `configured=true` and `available=true`, Synaplan can use Memories.

## Common configuration knobs (synaplan-memories)

These are set via `synaplan-memories/docker-compose.yml`:

- `SERVICE_API_KEY`: required in production
- `WEBHOOK_URL`: optional (Discord/Slack/…)
- `ENABLE_DAILY_STATS` + `STATS_INTERVAL_HOURS`: optional daily stats to webhook

## Troubleshooting

### “configured=true but available=false”

- Check the microservice is healthy:

```bash
docker compose ps
docker compose logs -f qdrant-service
```

- Ensure Synaplan uses the correct URL:
  - From inside Synaplan’s backend container, `http://localhost:8090` will not work.
  - Use `http://synaplan-qdrant-service:8090` (same Docker network).

### “Access denied / 401 from the service”

- Ensure `QDRANT_SERVICE_API_KEY` (Synaplan) matches `SERVICE_API_KEY` (microservice).

## Performance notes / benchmarking

If you want to compare Qdrant vs MariaDB VECTOR for typical operations (insert/update/search), use:

- [metadist/synaplan-vectordb-test](https://github.com/metadist/synaplan-vectordb-test)

## License

Apache-2.0. See [LICENSE](LICENSE).
